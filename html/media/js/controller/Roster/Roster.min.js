function filter(e,t){var n=t.keyCode,r=JSON.parse(window.localStorage.roster),i=Array();r.members.filter(function(t){if(e.name!==undefined&&t.character.name.toLowerCase().search(e["name"].toLowerCase())==-1){console.log("Added "+t.character.name+" because it's name matches");i.push(t.character.name)}if(e["race"]!="all"&&e.race!==undefined&&t.character.race!=e["race"]){console.log("Added "+t.character.name+" because its race matches");i.push(t.character.name)}if(e["class"]!="all"&&e["class"]!==undefined&&t.character.class!=e["class"]){console.log("Added "+t.character.name+" because its class matches");i.push(t.character.name)}if(e.minLevel!==undefined&&e.maxLevel!==undefined)if(t.character.level<parseInt(e.minLevel,10)||t.character.level>parseInt(e.maxLevel,10)){console.log("Added "+t.character.name+" because it's NOT in the level range");i.push(t.character.name)}if(e.rank!==undefined&&e["rank"]!="all"&&t.rank!=e["rank"]){console.log("Added "+t.character.name+" because it's NOT the correct rank");i.push(t.character.name)}});$.each(r.members,function(e,t){$.inArray(t.character.name,i)==-1&&$("tr.character."+t.character.name.toLowerCase()).removeClass("hidden").fadeIn("medium");$.inArray(t.character.name,i)!=-1&&$("tr.character."+t.character.name.toLowerCase()).addClass("hidden").fadeOut("medium")})}var roster=JSON.parse(window.localStorage.getItem("roster"));$.ajax({url:"/ajax/roster/all",type:"GET",dataType:"json",ifModified:!0}).done(function(e){alert("Fresh request made");window.localStorage.setItem("roster",JSON.stringify(e));$(".guild-roster tbody tr").remove();e.members.forEach(function(t,n,r){$(".guild-roster tbody").append('<tr class="character '+t.character.name.replace(" ","-").toLowerCase()+'">'+'<td class="character-name"><a class="'+e.classes[t.character.class].name.replace(" ","-").toLowerCase()+'" href="/roster/character/'+t.character.name.toLowerCase()+'">'+t.character.name+"</a></td>"+'<td class="race"><a href="/roster/race='+e.races[t.character.race].name.replace(" ","-").toLowerCase()+'"><img src="/media/images/races/race_'+t.character.race+"_"+t.character.gender+'.jpg" alt="'+e.races[t.character.race].name.replace(" ","-")+'" width="18" /></a></td>'+'<td class="class"><a href="/roster/class='+e.classes[t.character.class].name.replace(" ","-").toLowerCase()+'"><img src="/media/images/icons/56/classicon_'+e.classes[t.character.class].name.replace(" ","").toLowerCase()+'.jpg" alt="'+e.classes[t.character.class].name.replace(" ","-")+'" width="18" />'+("spec"in t.character?' <img src="/media/images/icons/56/'+t.character.spec.icon+'.jpg" alt="'+t.character.spec.name+'" class="spec" width="18" />':"")+"</a></td>"+'<td class="level">'+t.character.level+"</td>"+'<td class="guild-rank" data-id="'+t.rank+'"><a href="/roster/rank='+("rankname"in t?t.rankname:t.rank)+'">'+("rankname"in t?t.rankname:t.rank)+"</a></td>"+'<td class="achievements">'+t.character.achievementPoints+'<img src="/media/images/achievements.gif" alt="Achievement Points" width="8" /></td>'+"</tr>")})});delete window.roster;$(function(){$(window).on("resize",function(){if($(window).width()<="640"){$("th.guild-rank").html("Rank");$("th.achievements").html("Achiev's")}else{$("th.guild-rank").html("Guild Rank");$("th.achievements").html("Achievement Points")}});$("input.nojs").remove();var e=Array(),t="/roster";$('input[name="characterName"]').bind("keyup change",function(t){e.name=$(this).val();filter(e,t)});$('select[name="race"]').change(function(n){e.race=$(this).val();t=t.replace(/\/race=[\w\-]+/,"");if(e["race"]!="all"){var r=JSON.parse(window.localStorage.roster);t=t+"/race="+r.races[e.race].name.replace(" ","-").toLowerCase()}history.pushState(null,null,t);filter(e,n)});$('select[name="class"]').change(function(n){e["class"]=$(this).val();t=t.replace(/\/class=[\w\-]+/,"");if(e["class"]!="all"){var r=JSON.parse(window.localStorage.roster);t=t+"/class="+r.classes[e["class"]].name.replace(" ","-").toLowerCase()}history.pushState(null,null,t);filter(e,n)});$('input[name$="Level"]').bind("keyup change",function(n){input=$(this).attr("name");e[input]=$(this).val();t=t.replace(/\/level=[0-9]+[\-0-9]*/,"");e.minLevel===undefined&&(e.minLevel=$('input[name="minLevel"]').attr("min"));e.maxLevel===undefined&&(e.maxLevel=$('input[name="maxLevel"]').attr("max"));t=t+"/level="+e.minLevel+"-"+e.maxLevel;history.pushState(null,null,t);filter(e,n)});$('select[name="rank"]').change(function(n){e.rank=$(this).val();t=t.replace(/\/rank=[\w\-]+/,"");if(e["rank"]!="all"){var r=JSON.parse(window.localStorage.roster);t=t+"/rank="+r.ranks[e.rank].toString().replace(" ","-").toLowerCase()}history.pushState(null,null,t);filter(e,n)});$('input[type="reset"]').click(function(n){e=[];t="/roster";history.pushState(null,null,t);filter(e,n)})});